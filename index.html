<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prithvi House | Empros International School</title>

  <!-- External libs (Chart.js + EmailJS kept as you had) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    // keep your EmailJS init (unchanged)
    try {
      emailjs.init("EzWnTJC9VB_yxVTL0");
    } catch (e) {
      console.warn("EmailJS init failed:", e);
    }
  </script>

  <style>
    /* === GLOBAL RESET / ORIGINAL VISUALS PRESERVED === */
    * { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins",sans-serif; scroll-behavior:smooth; }
    html,body{height:100%}
    body {
      color:#fff;
      overflow-x:hidden;
      min-height:100vh;
      background:linear-gradient(270deg,#6a11cb,#2575fc,#00c6ff,#0072ff,#ff512f,#dd2476);
      background-size:1200% 1200%;
      animation:bgAnimation 15s ease infinite;
    }
    @keyframes bgAnimation{
      0%{background-position:0% 50%;}
      50%{background-position:100% 50%;}
      100%{background-position:0% 50%;}
    }

    /* Customer Care button (top-left) */
    .customer-care {
      position:fixed;
      top:18px;
      left:68px; /* leave space for hamburger */
      z-index:10050;
      background:linear-gradient(90deg,#00c853,#00796b);
      color:white;
      padding:8px 12px;
      border-radius:10px;
      font-weight:700;
      box-shadow:0 6px 20px rgba(0,0,0,0.4);
      cursor:pointer;
      border:2px solid rgba(255,255,255,0.06);
    }
    .customer-care:hover{ transform:translateY(-2px); }

    /* === HAMBURGER MENU (unchanged text/structure) === */
    .hamburger { position:fixed; top:20px; left:20px; font-size:28px; cursor:pointer; color:#fff; z-index:9999; transition:transform 0.3s ease,color 0.3s; text-shadow:0 0 10px rgba(255,255,255,0.5); }
    .hamburger:hover { transform:scale(1.2); color:#ffeb3b; }

    /* === SIDE NAV MENU (unchanged) === */
    nav { position:fixed; left:-250px; top:0; height:100%; width:220px; background:rgba(0,0,0,0.75); backdrop-filter:blur(12px); padding-top:80px; transition:left 0.4s ease-in-out; box-shadow:4px 0 10px rgba(0,0,0,0.5); z-index:9998; border-right:2px solid rgba(255,255,255,0.1); }
    nav.show { left:0; }
    nav ul { list-style:none; display:flex; flex-direction:column; gap:18px; padding-left:25px; }
    nav a { text-decoration:none; color:#fff; font-size:1.05rem; font-weight:500; transition:all 0.3s; letter-spacing:0.5px; }
    nav a:hover { color:#00e5ff; transform:translateX(6px); text-shadow:0 0 8px #00e5ff; }

    /* === MAIN LAYOUT (unchanged) === */
    main { padding:40px 20px; max-width:1000px; margin:90px auto; position:relative; z-index:1; }

    /* === SECTIONS/HEADINGS & other styles preserved exactly as original code === */
    .section { display:none; animation:fadeIn 0.8s ease-in-out; }
    .section.active { display:block; }
    h1,h2 { color:#fff; margin-bottom:14px; text-shadow:0 0 12px rgba(255,255,255,0.5); }
    h1{ font-size:2.3rem; } h2{ font-size:1.8rem; }
    .home-container { text-align:center; margin-top:40px; animation:fadeIn 1s ease-in-out; }
    .home-container h1 { font-size:2.5rem; background:linear-gradient(90deg,#ffeb3b,#00e5ff,#ff4081); -webkit-background-clip:text; -webkit-text-fill-color:transparent; animation:glowText 2s infinite alternate; }
    @keyframes glowText{ from{text-shadow:0 0 10px rgba(255,255,255,0.3);} to{text-shadow:0 0 25px rgba(255,255,255,0.8);} }
    .tagline{ font-size:1.3rem; font-weight:600; color:#f1f8e9; margin-bottom:20px; letter-spacing:1px; }
    .desc{ font-size:1rem; color:#f5f5f5; max-width:750px; margin:0 auto 25px; line-height:1.6; }
    .home-card{ background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.25); border-radius:14px; padding:25px; margin:20px auto; width:85%; max-width:550px; box-shadow:0 4px 20px rgba(0,0,0,0.3); transition: transform 0.3s, box-shadow 0.3s; }
    .home-card:hover{ transform:translateY(-4px); box-shadow:0 6px 25px rgba(255,255,255,0.2); }
    .join-btn{ display:inline-block; margin-top:15px; background:linear-gradient(135deg,#00e5ff,#7c4dff,#ff4081); color:white; text-decoration:none; padding:10px 20px; border-radius:30px; font-weight:600; box-shadow:0 0 10px rgba(255,255,255,0.4); transition:all 0.3s; }
    .join-btn:hover{ transform:scale(1.05); box-shadow:0 0 20px rgba(255,255,255,0.7); }
    .home-footer p{ margin-top:30px; font-style:italic; color:#ffebee; }
    .event-list li,.feedback-list li{ padding:10px 12px; background: rgba(255,255,255,0.12); border-radius:8px; margin-bottom:10px; box-shadow:0 1px 4px rgba(0,0,0,0.3); transition: transform 0.2s, background 0.3s; }
    .event-list li:hover,.feedback-list li:hover{ transform:scale(1.02); background: rgba(255,255,255,0.25); }
    .info-card{ background: rgba(255,255,255,0.15); padding:15px 20px; border-left:5px solid #ffeb3b; border-radius:10px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,0.3); color:#fff; }
    form{ display:flex; flex-direction:column; gap:12px; max-width:400px; background: rgba(255,255,255,0.1); padding:25px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.3); backdrop-filter: blur(10px); }
    input,textarea{ padding:12px; border:none; border-radius:10px; font-size:1rem; background: rgba(255,255,255,0.9); color:#000; transition:box-shadow 0.3s, transform 0.2s; }
    input:focus,textarea:focus{ box-shadow:0 0 10px #00e5ff; transform:scale(1.02); outline:none; }
    button{ background:linear-gradient(135deg,#ff4081,#7c4dff); color:white; border:none; border-radius:10px; padding:12px; font-weight:bold; cursor:pointer; transition:background 0.3s, transform 0.2s; box-shadow:0 0 10px rgba(255,255,255,0.4); }
    button:hover{ transform:scale(1.05); box-shadow:0 0 15px rgba(255,255,255,0.7); }
    .mail-choice, .method-choice { display:flex; justify-content:center; gap:20px; margin:25px 0; flex-wrap:wrap; }
    .mail-btn, .method-btn { font-size:1.05rem; font-weight:700; padding:14px 30px; border:none; border-radius:999px; cursor:pointer; color:#fff; transition:transform 0.25s, box-shadow 0.25s; box-shadow:0 6px 30px rgba(0,0,0,0.25); text-shadow:0 1px 8px rgba(0,0,0,0.2); }
    .mail-btn:hover, .method-btn:hover{ transform:translateY(-4px) scale(1.03); box-shadow:0 10px 40px rgba(0,0,0,0.35); }
    .report{ background:linear-gradient(90deg,#ff5252,#d32f2f); border:2px solid rgba(255,255,255,0.08); }
    .feedback{ background:linear-gradient(90deg,#00e676,#00c853); border:2px solid rgba(255,255,255,0.08); }
    .whatsapp{ background:linear-gradient(90deg,#25D366,#128C7E); border:2px solid rgba(255,255,255,0.08); }
    .email{ background:linear-gradient(90deg,#448aff,#2962ff); border:2px solid rgba(255,255,255,0.08); }
    #choice-title{ font-weight:700; letter-spacing:0.3px; color:#fff; text-shadow:0 0 12px rgba(255,255,255,0.5); width:100%; text-align:center; margin-bottom:6px; }
    @media(max-width:768px){ main{ margin-top:60px; padding:20px; } .home-card{ width:95%; } .desc{ font-size:0.95rem; } .mail-btn, .method-btn{ padding:12px 20px; font-size:1rem; } }
    @keyframes fadeIn{ from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }

    /* === LOGIN OVERLAY & EFFECTS (green cinematic) - tuned for speed & smoothness === */
    #loginOverlay {
      position:fixed; inset:0; z-index:10020; display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(0,80,30,0.85), rgba(0,40,20,0.95));
      overflow:hidden;
    }
    canvas.fullLayer { position:absolute; inset:0; width:100%; height:100%; display:block; z-index:10021; pointer-events:none; }
    #loginCard {
      position:relative; z-index:10030; width:420px; max-width:94%; padding:28px; border-radius:16px;
      background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(245,255,245,0.96));
      box-shadow: 0 30px 80px rgba(0,0,0,0.6); transform: translateY(24px) scale(0.98); opacity:0;
      transition: transform 0.55s cubic-bezier(.2,.95,.25,1), opacity 0.45s ease;
    }
    #loginCard.show { transform: translateY(0) scale(1); opacity:1; }
    #loginCard h2 { color:#064b2b; margin-bottom:6px; }
    #loginCard p { color:#064b2b; opacity:0.95; margin-bottom:14px; }
    .login-input { width:100%; padding:12px; border-radius:10px; border:2px solid rgba(11,95,43,0.12); font-size:15px; margin-bottom:12px; background:white; color:#000; }
    .login-btns { display:flex; gap:12px; margin-top:6px; }
    .btn-primary { flex:1; background:linear-gradient(90deg,#00a859,#007f3b); color:#fff; border:none; padding:11px 12px; border-radius:10px; cursor:pointer; font-weight:700; }
    .btn-ghost { flex:1; background:transparent; color:#064b2b; border:2px solid rgba(6,75,43,0.12); padding:11px 12px; border-radius:10px; cursor:pointer; }
    .small-note { font-size:13px; color:rgba(255,255,255,0.85); margin-top:10px; text-align:center; }
    .login-error { color:#ffdddd; background:rgba(255,0,0,0.12); padding:8px 10px; border-radius:8px; margin-top:6px; display:none; font-size:14px; text-align:center; }
    /* hide the allowed-names visual list to keep the login clean (JS still validates) */
    .small-note { display:none; }
    @media(max-width:420px){ #loginCard{ padding:16px; } }

  </style>
</head>
<body>
  <!-- Customer care button -->
  <button id="customerCareBtn" class="customer-care" title="Contact Customer Care">Customer Care</button>

  <!-- LOGIN OVERLAY (appears first) -->
  <div id="loginOverlay" aria-hidden="false">
    <!-- canvas order: base particles, leaves, explosion flash -->
    <canvas id="particlesLayer" class="fullLayer"></canvas>
    <canvas id="leavesLayer" class="fullLayer"></canvas>
    <canvas id="explosionLayer" class="fullLayer"></canvas>

    <div id="loginCard" role="dialog" aria-labelledby="loginTitle" aria-modal="true">
      <h2 id="loginTitle">Prithvi House ‚Äî Login</h2>
      <p>Type your username (no password needed). If your name isn't in the list, use "Login as Guest".</p>

      <input id="loginName" class="login-input" type="text" placeholder="Type your name (e.g. Vedant)" autocomplete="off" />

      <div class="login-btns">
        <button id="loginSubmit" class="btn-primary">Login</button>
        <button id="guestBtn" class="btn-ghost">Login as Guest</button>
      </div>

      <div id="loginError" class="login-error">Name not recognized. You can use "Login as Guest" to continue.</div>
      <!-- visible list intentionally removed for cleaner login (JS still validates) -->
    </div>
  </div>

  <!-- Audio removed as requested -->
  <div class="hamburger" style="z-index:2">‚ò∞</div>

  <nav>
    <ul>
      <li><a href="#" data-section="home">üè† Home</a></li>
      <li><a href="#" data-section="students">üéØ Students Leading</a></li>
      <li><a href="#" data-section="events">üèÖ Upcoming Events/Sports</a></li>
      <li><a href="#" data-section="info">‚ÑπÔ∏è About Prithvi House</a></li>
      <li><a href="#" data-section="feedback">üí¨ Feedbacks</a></li>
      <li><a href="#" data-section="media">üì∏ Photos / Media</a></li>
      <li><a href="#" data-section="mail">‚úâÔ∏è report/feedback Mail</a></li>
    </ul>
  </nav>

  <main>
    <!-- HOME -->
    <section id="home" class="section active">
      <div class="home-container">
        <h1>Welcome to Prithvi House</h1>
        <p class="tagline">"The Green Guardians of Empros International School"</p>
        <p class="desc">Prithvi House represents growth, balance, and harmony with nature. We believe in teamwork, discipline, and innovation ‚Äî shining bright in academics, sports, and culture alike.</p>

        <div class="home-card">
          <h2>About This Website</h2>
          <p>This is the official platform for Prithvi House members at Empros International School, Talegaon Dabhade. Here you can explore our leading students, upcoming inter-house events, house updates, and even send us your valuable feedback.</p>
        </div>

        <div class="home-card">
          <h2>Join Our Community</h2>
          <a href="https://chat.whatsapp.com/KDaPoZXibz4CE5ouyIKdVR?mode=wwc" target="_blank" class="join-btn">Join WhatsApp Community</a>
        </div>

        <div class="home-footer"><p>‚ÄúTogether we grow, together we shine ‚Äì We are Prithvi House.‚Äù üåç</p></div>
      </div>
    </section>

    <!-- STUDENTS -->
    <section id="students" class="section">
      <h2>Top Performing Students</h2>
      <canvas id="studentChart"></canvas>
    </section>

    <!-- EVENTS -->
    <section id="events" class="section">
      <h2>Upcoming Events & Sports</h2>
      <ul class="event-list">
        <li>üèè Inter-House Cricket Matches update soon</li>
        <li>üèÉ‚Äç‚ôÄÔ∏è Annual Sports Meet ‚Äì update soon</li>
        <li>‚öΩ Inter-House Football Finals ‚Äì Date to be Announced</li>
        <li>üèÜ Tug of War Championship ‚Äì Coming Soon!</li>
      </ul>
    </section>

    <!-- INFO -->
    <section id="info" class="section">
      <h2>About Prithvi House</h2>
      <div class="info-card">
        <strong>Prefect:</strong> Princika<br>
        <strong>Vice Prefect:</strong> Kartik<br>
        <strong>House Teacher:</strong> Prajita Nair Ma‚Äôam
      </div>
      <p>üåç Prithvi House symbolizes <strong>Earth</strong>, the mother of life and balance. It represents strength, patience, and steady growth. We believe in nurturing talents, respecting all beings, and striving for excellence while staying humble.</p>
      <p>Our motto: <em>‚ÄúRooted in values, rising towards excellence.‚Äù</em></p>
    </section>

    <!-- FEEDBACK -->
    <section id="feedback" class="section">
      <h2>Feedbacks from Prithvi House Students</h2>
      <ul class="feedback-list">
        <li>Vedant ‚Äì ‚ÄúI love being part of a team that believes in growth.‚Äù</li>
        <li>Kunal ‚Äì ‚ÄúPrithvi House gives me motivation and strength.‚Äù</li>
        <li>Chinmay ‚Äì ‚ÄúI enjoy every event and competition we have!‚Äù</li>
        <li>Sejal ‚Äì ‚ÄúThe unity and energy in Prithvi House are unmatched.‚Äù</li>
        <li>Aditi ‚Äì ‚ÄúWe are not just a house, we are a family.‚Äù</li>
        <li>Tvisha ‚Äì ‚ÄúProud to represent the Earth and our team!‚Äù</li>
        <li>Vishal ‚Äì ‚ÄúPrithvi House helps me stay balanced and focused.‚Äùli>
        <li>Mit ‚Äì ‚ÄúEvery event is a new learning experience.‚Äùli>
        <li>Gauri ‚Äì ‚ÄúWe believe in peace, hard work, and creativity.‚Äùli>
        <li>Abhinav ‚Äì ‚ÄúIt‚Äôs always fun being part of Prithvi House.‚Äùli>
        <li>Jivani ‚Äì ‚ÄúOur team spirit makes us stronger.‚Äùli>
        <li>Yuvraj ‚Äì ‚ÄúGo Prithvi House! Always forward.‚Äùli>
        <li>Shlok ‚Äì ‚ÄúWe rise by lifting others.‚Äùli>
        <li>Sarth ‚Äì ‚ÄúI feel proud to represent our house.‚Äùli>
        <li>Arnav ‚Äì ‚ÄúEvery challenge makes us better.‚Äùli>
        <li>Aditya ‚Äì ‚ÄúOur motto keeps me inspired every day.‚Äùli>
        <li>Swarali ‚Äì ‚ÄúPrithvi House means teamwork and passion.‚Äùli>
        <li>Jagrav ‚Äì ‚ÄúWe always give our best together.‚Äùli>
        <li>Ishita ‚Äì ‚ÄúNature, balance, and positivity define us.‚Äùli>
        <li>Vaidehi ‚Äì ‚ÄúOur strength is our unity.‚Äùli>
        <li>Kinjal ‚Äì ‚ÄúProud to be part of the green spirit!‚Äùli>
        <li>Aarohi ‚Äì ‚ÄúWe grow like trees, strong and humble.‚Äùli>
        <li>Ansh ‚Äì ‚ÄúPrithvi House rocks every event!‚Äùli>
      </ul>
    </section>

    <!-- MEDIA -->
    <section id="media" class="section">
      <h2>Photos & Media</h2>
      <div class="home-card">
        <p>üé• Explore our moments, achievements, and videos on our official YouTube Channel.</p>
        <a href="https://www.youtube.com/@EISPrithvihouse" target="_blank" class="join-btn">Visit Our YouTube Channel</a>
      </div>
      <div class="media-gallery">
        <iframe width="100%" height="315" src="https://www.youtube.com/embed/videoseries?list=UU" title="Prithvi House Channel" frameborder="0" allowfullscreen></iframe>
      </div>
    </section>

    <!-- MAIL -->
    <section id="mail" class="section">
      <h2>Send a Message to Prithvi House Team</h2>

      <!-- STEP 1: Choose Report / Feedback -->
      <div id="mail-options" class="mail-choice">
        <button class="mail-btn report"><span style="font-size:1.05rem">üö®</span> <span style="text-decoration:underline; text-transform:uppercase;">Report</span></button>
        <button class="mail-btn feedback"><span style="font-size:1.05rem">üíö</span> <span style="text-decoration:underline; text-transform:uppercase;">Feedback</span></button>
      </div>

      <!-- STEP 2: Choose WhatsApp / Email -->
      <div id="method-options" class="method-choice" style="display:none;">
        <div id="choice-title"> </div>
        <button id="backMethod" class="back-btn" style="display:none; background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.4); color:#fff; border-radius:30px; padding:10px 25px; font-weight:600; cursor:pointer; margin-bottom:15px;">üîô Back</button>
        <button class="method-btn whatsapp"><span style="font-weight:800">üí¨</span> <span style="font-weight:700">Send on WhatsApp</span><br><small style="opacity:0.9">Direct to +91 8080462808</small></button>
        <button class="method-btn email"><span style="font-weight:800">‚úâÔ∏è</span> <span style="font-weight:700">Send via Email</span><br><small style="opacity:0.9">Securely via EmailJS</small></button>
      </div>

      <!-- STEP 3: Email FORM (appears only if Email chosen) -->
      <form id="contact-form" style="display:none;">
        <input type="text" id="name" placeholder="Your Name" required>
        <input type="email" id="email" placeholder="Your Email" required>
        <textarea id="message" rows="4" placeholder="Your Message..." required></textarea>
        <button type="submit">Send Mail</button>
      </form>
      <p id="mail-status"></p>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", ()=>{

      /* ================================
         LOGIN OVERLAY: particles, leaves,
         explosion (spark + flash) and reveal logic
         Tuned for GitHub Pages and quick smoothness
         ================================ */

      // allowed usernames (case-insensitive)
      const allowedUsers = [
        "Vedant","Kunal","Chinmay","Sejal","Aditi","Tvisha","kartik","Princika",
        "Jagraon","mit","Gauri","Abhinav","jivani","Yuvraj","shlok","sarth",
        "Arnav","Aditya","swarali","jagrav","Ishita","vaidehi","Kinjal","Aarohi","Ansh"
      ].map(s=>s.toLowerCase());

      let currentUser = null;

      // DOM references
      const overlay = document.getElementById('loginOverlay');
      const particlesCanvas = document.getElementById('particlesLayer');
      const leavesCanvas = document.getElementById('leavesLayer');
      const explosionCanvas = document.getElementById('explosionLayer');
      const loginCard = document.getElementById('loginCard');
      const loginName = document.getElementById('loginName');
      const loginSubmit = document.getElementById('loginSubmit');
      const guestBtn = document.getElementById('guestBtn');
      const loginError = document.getElementById('loginError');

      // base sizing for canvases
      function sizeCanvas(c){
        c.width = window.innerWidth * devicePixelRatio;
        c.height = window.innerHeight * devicePixelRatio;
        c.style.width = window.innerWidth + "px";
        c.style.height = window.innerHeight + "px";
        const ctx = c.getContext('2d');
        ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
      }
      sizeCanvas(particlesCanvas); sizeCanvas(leavesCanvas); sizeCanvas(explosionCanvas);
      window.addEventListener('resize', ()=>{ sizeCanvas(particlesCanvas); sizeCanvas(leavesCanvas); sizeCanvas(explosionCanvas); });

      /* -------------------
         gentle ambient particles (background)
         - subtle, low-cost
         ------------------- */
      const pCtx = partic
      particlesCanvas.getContext('2d');
      let particles = [];
      function createParticles(n=100){
        particles = [];
        for(let i=0;i<n;i++){
          particles.push({
            x: Math.random()*particlesCanvas.width/devicePixelRatio,
            y: Math.random()*particlesCanvas.height/devicePixelRatio,
            r: 0.6 + Math.random()*1.6,
            vx: (Math.random()-0.5)*0.35,
            vy: -0.15 - Math.random()*0.45,
            alpha: 0.06 + Math.random()*0.5,
            life: 160 + Math.random()*300
          });
        }
      }
      createParticles(120);
      function updateParticles(){
        pCtx.clearRect(0,0,particlesCanvas.width/devicePixelRatio,particlesCanvas.height/devicePixelRatio);
        for(let p of particles){
          p.x += p.vx;
          p.y += p.vy;
          p.life--;
          if(p.life < 0 || p.y < -60 || p.x < -60 || p.x > particlesCanvas.width/devicePixelRatio + 60) {
            p.x = Math.random()*particlesCanvas.width/devicePixelRatio;
            p.y = particlesCanvas.height/devicePixelRatio + Math.random()*80;
            p.vx = (Math.random()-0.5)*0.6;
            p.vy = -0.25 - Math.random()*0.6;
            p.life = 160 + Math.random()*300;
          }
          pCtx.beginPath();
          pCtx.fillStyle = `rgba(255,255,255,${p.alpha})`;
          pCtx.arc(p.x,p.y,p.r,0,Math.PI*2);
          pCtx.fill();
        }
        requestAnimationFrame(updateParticles);
      }
      updateParticles();

      /* -------------------
         falling leaves (visual)
         - moderate performance tuned
         ------------------- */
      const lCtx = leavesCanvas.getContext('2d');
      function leafShape(ctx,x,y,size,angle,hue){
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate(angle);
        ctx.scale(size,size);
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.bezierCurveTo(12,-8,36,-10,52,2);
        ctx.bezierCurveTo(36,18,12,20,0,0);
        ctx.closePath();
        const g = ctx.createLinearGradient(0,-8,40,18);
        g.addColorStop(0, `hsl(${hue},60%,55%)`);
        g.addColorStop(1, `hsl(${(hue+30)%360},60%,40%)`);
        ctx.fillStyle = g;
        ctx.shadowColor = `rgba(0,0,0,0.12)`;
        ctx.shadowBlur = 6;
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.quadraticCurveTo(25,0,52,2);
        ctx.strokeStyle = `rgba(255,255,255,0.12)`;
        ctx.lineWidth = 1.2;
        ctx.stroke();
        ctx.restore();
      }

      let leaves = [];
      function createLeaves(count=20){
        leaves = [];
        for(let i=0;i<count;i++){
          leaves.push({
            x: Math.random()*leavesCanvas.width/devicePixelRatio,
            y: -Math.random()*leavesCanvas.height/devicePixelRatio,
            size: 0.6 + Math.random()*1.1,
            angle: Math.random()*Math.PI*2,
            rotSpeed: (Math.random()-0.5)*0.03,
            vx: (Math.random()-0.5)*0.7,
            vy: 0.8 + Math.random()*1.4,
            hue: 100 + Math.random()*40,
            sway: Math.random()*0.02 + 0.008,
            life: 200 + Math.random()*500
          });
        }
      }
      createLeaves(24);

      function updateLeaves(){
        lCtx.clearRect(0,0,leavesCanvas.width/devicePixelRatio,leavesCanvas.height/devicePixelRatio);
        for(let lf of leaves){
          lf.x += lf.vx + Math.sin(lf.y*lf.sway)*0.65;
          lf.y += lf.vy;
          lf.angle += lf.rotSpeed;
          lf.life--;
          leafShape(lCtx, lf.x, lf.y, lf.size, lf.angle, lf.hue);
          if(lf.y > leavesCanvas.height/devicePixelRatio + 40 || lf.x < -120 || lf.x > leavesCanvas.width/devicePixelRatio + 120 || lf.life < 0){
            lf.x = Math.random()*leavesCanvas.width/devicePixelRatio;
            lf.y = -30 - Math.random()*240;
            lf.size = 0.6 + Math.random()*1.2;
            lf.vy = 0.8 + Math.random()*1.6;
            lf.rotSpeed = (Math.random()-0.5)*0.04;
            lf.hue = 100 + Math.random()*40;
            lf.life = 200 + Math.random()*500;
          }
        }
        requestAnimationFrame(updateLeaves);
      }

      /* -------------------
         Explosion (spark + flash)
         - combined effects, faster but cinematic
         ------------------- */
      const eCtx = explosionCanvas.getContext('2d');
      let explosionRunning = false;

      function runExplosion(x = window.innerWidth/2, y = window.innerHeight/2){
        if(explosionRunning) return;
        explosionRunning = true;

        // sparks
        const sparks = [];
        const sparkCount = 60 + Math.floor(Math.random()*40); // moderate
        for(let i=0;i<sparkCount;i++){
          const angle = Math.random()*Math.PI*2;
          const speed = 3 + Math.random()*6;
          sparks.push({
            x, y,
            vx: Math.cos(angle)*speed,
            vy: Math.sin(angle)*speed,
            life: 20 + Math.random()*30,
            size: 1 + Math.random()*3,
            hue: 40 + Math.random()*110,
            alpha: 0.9 + Math.random()*0.2
          });
        }

        // outward leaf impulse: slightly push visible leaves visually by modifying vx/vy briefly
        for(let lf of leaves){
          const dx = lf.x - x, dy = lf.y - y;
          const dist = Math.sqrt(dx*dx + dy*dy) + 10;
          const force = 12000 / (dist*dist);
          lf.vx += (dx/dist) * force * 0.00005;
          lf.vy += (dy/dist) * force * 0.00005;
        }

        // flash overlay variables (fast fade)
        let flashAlpha = 1.0;
        function tick(){
          eCtx.clearRect(0,0,explosionCanvas.width/devicePixelRatio,explosionCanvas.height/devicePixelRatio);
          // soft radial flash (fast)
          if(flashAlpha > 0){
            const g = eCtx.createRadialGradient(x,y,0,x,y,Math.max(window.innerWidth,window.innerHeight)*0.7);
            g.addColorStop(0, `rgba(255,255,220,${flashAlpha})`);
            g.addColorStop(0.18, `rgba(200,255,190,${flashAlpha*0.6})`);
            g.addColorStop(1, `rgba(0,0,0,0)`);
            eCtx.fillStyle = g;
            eCtx.fillRect(0,0,explosionCanvas.width/devicePixelRatio,explosionCanvas.height/devicePixelRatio);
            flashAlpha -= 0.06; // quicker fade
          }

          // draw sparks
          for(let i=sparks.length-1;i>=0;i--){
            const s = sparks[i];
            s.x += s.vx;
            s.y += s.vy;
            s.vx *= 0.93; s.vy *= 0.93; s.vy += 0.08; // gravity-ish
            s.life--;
            if(s.life <= 0) sparks.splice(i,1);
            else {
              eCtx.beginPath();
              eCtx.fillStyle = `hsla(${s.hue},90%,60%,${(s.alpha * (s.life/40)).toFixed(3)})`;
              eCtx.shadowBlur = 10;
              eCtx.shadowColor = `hsla(${s.hue},90%,60%,${s.alpha})`;
              eCtx.arc(s.x, s.y, s.size * (s.life/40), 0, Math.PI*2);
              eCtx.fill();
            }
          }

          if(sparks.length > 0 || flashAlpha > 0.02){
            requestAnimationFrame(tick);
          } else {
            eCtx.clearRect(0,0,explosionCanvas.width/devicePixelRatio,explosionCanvas.height/devicePixelRatio);
            explosionRunning = false;
            // reveal login card after a tiny delay for smoothness
            setTimeout(()=> {
              loginCard.classList.add('show');
              // optional small particle pop when login appears
              smallPop(window.innerWidth/2, window.innerHeight*0.44);
            }, 120);
          }
        }
        tick();
      }

      // small pop effect (tiny ephemeral particles) to accent reveal
      function smallPop(cx, cy){
        const ctx = explosionCanvas.getContext('2d');
        const mini = [];
        for(let i=0;i<22;i++){
          const angle = (Math.PI*2) * Math.random();
          const speed = 1 + Math.random()*3;
          mini.push({
            x: cx, y: cy, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed,
            life: 12 + Math.random()*12, size: 1 + Math.random()*3, hue: 80 + Math.random()*80
          });
        }
        function drawMini(){
          ctx.clearRect(0,0,explosionCanvas.width/devicePixelRatio,explosionCanvas.height/devicePixelRatio);
          for(let i=mini.length-1;i>=0;i--){
            const m = mini[i];
            m.x += m.vx; m.y += m.vy; m.vy += 0.06; m.life--;
            if(m.life <= 0) mini.splice(i,1);
            else {
              ctx.beginPath();
              ctx.fillStyle = `hsla(${m.hue},80%,60%,${(m.life/20).toFixed(2)})`;
              ctx.arc(m.x, m.y, m.size, 0, Math.PI*2);
              ctx.fill();
            }
          }
          if(mini.length > 0) requestAnimationFrame(drawMini);
          else ctx.clearRect(0,0,explosionCanvas.width/devicePixelRatio,explosionCanvas.height/devicePixelRatio);
        }
        drawMini();
      }

      /* -------------------
         orchestrate entrance:
         - start leaves quickly,
         - run explosion earlier (fast) for quick smoothness
         ------------------- */
      setTimeout(()=> updateLeaves(), 360); // small delay to ensure canvas sizing
      setTimeout(()=> runExplosion(window.innerWidth*0.5, window.innerHeight*0.44), 1100);

      // allow click to trigger explosion early
      overlay.addEventListener('click', (e)=>{
        if(!explosionRunning){
          const rect = overlay.getBoundingClientRect();
          runExplosion(e.clientX - rect.left, e.clientY - rect.top);
        }
      });

      // fallback reveal if nothing triggered
      setTimeout(()=> {
        if(!loginCard.classList.contains('show') && !explosionRunning){
          loginCard.classList.add('show');
        }
      }, 2400);

      /* -------------------
         Login logic (no password) ‚Äî allowed users only, guest option
         ------------------- */
      function normalizeName(name){ return (name||"").trim().toLowerCase(); }

      loginSubmit.addEventListener('click', ()=>{
        const val = normalizeName(loginName.value);
        if(!val){ loginError.style.display = "block"; loginError.innerText = "Please type your name."; setTimeout(()=> loginError.style.display='none',2200); return; }
        if(allowedUsers.includes(val)){
          currentUser = loginName.value.trim();
          afterLogin();
        } else {
          loginError.style.display = "block";
          loginError.innerText = "Name not recognized. Use 'Login as Guest' or re-check spelling.";
          setTimeout(()=> loginError.style.display='none',2800);
        }
      });

      loginName.addEventListener('keydown', (e)=> { if(e.key === 'Enter') loginSubmit.click(); });

      guestBtn.addEventListener('click', ()=>{
        const guest = prompt("Enter guest name to continue (will appear as your name):", "");
        if(guest && guest.trim().length > 0){
          currentUser = guest.trim();
          afterLogin();
        }
      });

      function afterLogin(){
        // prefill mail name input when later used
        const nameInputMain = document.getElementById('name');
        if(nameInputMain) nameInputMain.value = currentUser;
        // hide overlay with smooth transition
        loginCard.classList.remove('show');
        overlay.style.transition = 'opacity 0.6s ease, visibility 0.6s';
        overlay.style.opacity = 0;
        setTimeout(()=> { overlay.style.display = 'none'; overlay.setAttribute('aria-hidden','true'); }, 700);
        // optional small console welcome
        console.log("Logged in as:", currentUser);
      }

      /* ================================
         CUSTOMER CARE button behavior
         opens mailto: with subject and body (includes currentUser if set)
         ================================ */
      const careBtn = document.getElementById('customerCareBtn');
      careBtn.addEventListener('click', ()=>{
        const to = "prithvihouseheadteamreport@gmail.com";
        const subject = encodeURIComponent("Customer Care - Prithvi House");
        const body = encodeURIComponent(`Hello Prithvi House Team,%0A%0A[Write your message here]%0A%0AFrom: ${currentUser ? currentUser : 'Visitor (not logged in)'}%0A`);
        window.location.href = `mailto:${to}?subject=${subject}&body=${body}`;
      });

      /* ================================
         ORIGINAL SITE JS (menu, navigation, chart, mail)
         preserved & integrated (kept same text & behavior)
         ================================ */

      // MENU TOGGLE
      const hamburger = document.querySelector(".hamburger");
      const nav = document.querySelector("nav");
      const links = document.querySelectorAll("nav a");
      const sections = document.querySelectorAll(".section");

      hamburger.addEventListener("click", () => {
        nav.classList.toggle("show");
      });

      // navigation links -> show sections
      links.forEach(link => {
        link.addEventListener("click", e => {
          e.preventDefault();
          const id = link.getAttribute("data-section");
          if (!id) return;
          sections.forEach(s => s.classList.remove("active"));
          const target = document.getElementById(id);
          if (target) target.classList.add("active");
          nav.classList.remove("show");
        });
      });

      // STUDENT CHART (keeps your static data)
      try {
        const ctx = document.getElementById("studentChart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["Vedant","Kunal","Chinmay","Sejal","Aditi","Tvisha","Vishal","Mit","Gauri","Abhinav","Jivani","Yuvraj","Shlok","Sarth","Arnav","Aditya","Swarali","Jagrav","Ishita","Vaidehi","Kinjal","Aarohi","Ansh"],
            datasets: [{
              label:"Performance Score",
              data:[90,88,86,92,85,91,84,80,83,89,87,82,90,88,85,91,89,86,90,87,84,83,88],
              backgroundColor:["#ff4081","#7c4dff","#00e5ff","#ffeb3b","#ff5722","#4caf50","#03a9f4","#e91e63","#009688","#8bc34a","#ffc107","#9c27b0","#00bcd4","#f44336","#2196f3","#673ab7","#ff9800","#cddc39","#4db6ac","#3f51b5","#0097a7","#b388ff","#26c6da"]
            }]
          },
          options:{ responsive:true, scales:{ y:{ beginAtZero:true, max:100 } } }
        });
      } catch (err) {
        console.warn("ChartJS init failed:", err);
      }

      // MAIL LOGIC (NEW) ‚Äî unchanged logic, just integrated
      const mailOptions = document.getElementById('mail-options');
      const methodOptions = document.getElementById('method-options');
      const contactForm = document.getElementById('contact-form');
      const choiceTitle = document.getElementById('choice-title');
      const mailStatus = document.getElementById('mail-status');

      let selectedType = "";

      const reportBtn = document.querySelector('.report');
      const feedbackBtn = document.querySelector('.feedback');

      if (reportBtn) {
        reportBtn.addEventListener('click', () => {
          selectedType = "Report";
          choiceTitle.innerHTML = `<strong style="font-size:1.05rem">You selected</strong>
            <div style="font-size:1.25rem; margin-top:6px; font-weight:900; color:#ffdedb; text-shadow:0 0 12px rgba(255,100,100,0.6);">REPORT</div>`;
          mailOptions.style.display = "none";
          methodOptions.style.display = "flex";
          const backMethod = document.getElementById('backMethod'); if(backMethod) backMethod.style.display='inline-block';
        });
      }

      if (feedbackBtn) {
        feedbackBtn.addEventListener('click', () => {
          selectedType = "Feedback";
          choiceTitle.innerHTML = `<strong style="font-size:1.05rem">You selected</strong>
            <div style="font-size:1.25rem; margin-top:6px; font-weight:900; color:#d9ffea; text-shadow:0 0 12px rgba(80,255,150,0.5);">FEEDBACK</div>`;
          mailOptions.style.display = "none";
          methodOptions.style.display = "flex";
          const backMethod = document.getElementById('backMethod'); if(backMethod) backMethod.style.display='inline-block';
        });
      }

      const backMethod = document.getElementById('backMethod');
      if(backMethod) backMethod.addEventListener('click', ()=>{
        methodOptions.style.display = "none";
        mailOptions.style.display = "flex";
        backMethod.style.display='none';
      });

      // WhatsApp open
      const waBtn = document.querySelector('.whatsapp');
      if (waBtn) {
        waBtn.addEventListener('click', () => {
          const template = `*${selectedType} to Prithvi House*%0A%0AHello Team,%0A%0A[Write your message here]%0A%0AFrom: ${currentUser || ''}`;
          const waUrl = `https://wa.me/918080462808?text=${encodeURIComponent(template)}`;
          window.open(waUrl, '_blank');
        });
      }

      // Email option -> show form
      const emailBtn = document.querySelector('.email');
      if (emailBtn) {
        emailBtn.addEventListener('click', () => {
          methodOptions.style.display = "none";
          contactForm.style.display = "flex";
          document.getElementById('message').value = `[${selectedType}] `;
          if(currentUser){
            document.getElementById('name').value = currentUser;
          }
          document.getElementById('email').focus();
        });
      }

      // send via EmailJS
      contactForm.addEventListener("submit", function(e) {
        e.preventDefault();
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        const message = document.getElementById("message").value.trim();

        if (!name || !email || !message) {
          mailStatus.innerText = "Please complete all fields.";
          return;
        }

        mailStatus.innerText = "Sending...";

        emailjs.send("service_2lklg8e", "template_6cmr2gw", {
          from_name: name,
          from_email: email,
          message: `[${selectedType}] ${message}`
        }).then(() => {
          mailStatus.innerText = "‚úÖ Mail Sent Successfully!";
          contactForm.reset();
          contactForm.style.display = "none";
          methodOptions.style.display = "none";
          setTimeout(()=>{ mailStatus.innerText=""; mailOptions.style.display="flex"; }, 1800);
        }, (error) => {
          console.error("EmailJS error:", error);
          mailStatus.innerText = "‚ùå Error sending mail! Please try again later.";
        });
      });

    }); // DOMContentLoaded end
  </script>
</body>
</html>
